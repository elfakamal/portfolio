var works = [
		{
			group		: "Neiio Redesign",
			title       : "Slogans",
			thumbUrl    : "neiio-redesign/1.png",
			tags        : ["Web", "Graphic"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "Neiio Redesign",
			title       : "Neiio Connect",
			thumbUrl    : "neiio-redesign/2.png",
			tags        : ["Web", "Graphic"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "Neiio Redesign",
			title       : "Neiio Connect",
			thumbUrl    : "neiio-redesign/3.png",
			tags        : ["Web", "Graphic"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "Neiio Redesign",
			title       : "Groups",
			thumbUrl    : "neiio-redesign/4.png",
			tags        : ["Web", "Graphic"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "Neiio Redesign",
			title       : "Groups",
			thumbUrl    : "neiio-redesign/5.png",
			tags        : ["Web", "Graphic"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "Neiio Redesign",
			title       : "Neiio Organize",
			thumbUrl    : "neiio-redesign/6.png",
			tags        : ["Web", "Graphic"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "Neiio Redesign",
			title       : "Groups",
			thumbUrl    : "neiio-redesign/7.png",
			tags        : ["Web", "Graphic"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "Neiio Redesign",
			title       : "Neiio Organize",
			thumbUrl    : "neiio-redesign/8.png",
			tags        : ["Web", "Graphic"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "Neiio Redesign",
			title       : "Neiio Organize",
			thumbUrl    : "neiio-redesign/9.png",
			tags        : ["Web", "Graphic"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "Neiio Redesign",
			title       : "Neiio Organize",
			thumbUrl    : "neiio-redesign/10.png",
			tags        : ["Web", "Graphic"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "Neiio Redesign",
			title       : "Neiio Organize",
			thumbUrl    : "neiio-redesign/11.png",
			tags        : ["Web", "Graphic"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "Neiio Redesign",
			title       : "Neiio Organize",
			thumbUrl    : "neiio-redesign/12.png",
			tags        : ["Web", "Graphic"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "Neiio Redesign",
			title       : "Neiio Organize",
			thumbUrl    : "neiio-redesign/13.png",
			tags        : ["Web", "Graphic"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "Neiio Redesign",
			title       : "Neiio Organize",
			thumbUrl    : "neiio-redesign/14.png",
			tags        : ["Web", "Graphic"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "Neiio Redesign",
			title       : "Neiio Organize",
			thumbUrl    : "neiio-redesign/15.png",
			tags        : ["Web", "Graphic"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "Neiio Redesign",
			title       : "Neiio Organize",
			thumbUrl    : "neiio-redesign/16.png",
			tags        : ["Web", "Graphic"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "Neiio Redesign",
			title       : "Neiio Organize",
			thumbUrl    : "neiio-redesign/17.png",
			tags        : ["Web", "Graphic"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "Neiio Redesign",
			title       : "Neiio Redesign",
			thumbUrl    : "neiio-redesign/thumb.png",
			tags        : ["Web", "Graphic", "Logo", "Business Card"],
			description	: "",
			heightRatio	: true,
			diaporama	: false
		},





		{
			group		: "CSI",
			title       : "Solutions",
			thumbUrl    : "csi/2.png",
			tags        : ["Web", "Logo"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "CSI",
			title       : "Home",
			thumbUrl    : "csi/1.png",
			tags        : ["Web", "Logo"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "CSI",
			title       : "CSI",
			thumbUrl    : "csi/thumb.png",
			imageUrl	: "csi/3.png",
			tags        : ["Web", "Logo"],
			description	: "",
			heightRatio	: true
		},





		{
			group       : "HTag",
			title       : "HTag",
			thumbUrl    : "htag/1.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group       : "HTag",
			title       : "HTag",
			thumbUrl    : "htag/2.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group       : "HTag",
			title       : "HTag",
			thumbUrl    : "htag/5.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group       : "HTag",
			title       : "HTag",
			thumbUrl    : "htag/thumb.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},





		{
			group		: "Personal",
			title       : "Personal",
			thumbUrl    : "personal/1.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "Personal",
			title       : "Personal",
			thumbUrl    : "personal/2.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "Personal",
			title       : "Personal",
			thumbUrl    : "personal/3.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "Personal",
			title       : "Personal",
			thumbUrl    : "personal/thumb.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},





		{
			group		: "ZigZag",
			title       : "Wireframing",
			thumbUrl    : "zigzag/1.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
//		{
//			group		: "ZigZag",
//			title       : "Vertical ZigZag",
//			thumbUrl    : "zigzag/2.png",
//			tags        : ["Graphic", "Logo"],
//			heightRatio	: true
//		},
		{
			group		: "ZigZag",
			title       : "ZigZag logo",
			thumbUrl    : "zigzag/3.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "ZigZag",
			title       : "ZigZag logo",
			thumbUrl    : "zigzag/4.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "ZigZag",
			title       : "ZigZag logo",
			thumbUrl    : "zigzag/5.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "ZigZag",
			title       : "ZigZag logo",
			thumbUrl    : "zigzag/6.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "ZigZag",
			title       : "ZigZag logo",
			thumbUrl    : "zigzag/7.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "ZigZag",
			title       : "Business Card",
			thumbUrl    : "zigzag/8.png",
			tags        : ["Business Card"],
			heightRatio	: true
		},
		{
			group		: "ZigZag",
			title       : "Business Card",
			thumbUrl    : "zigzag/9.png",
			tags        : ["Business Card"],
			heightRatio	: true
		},
		{
			group		: "ZigZag",
			title       : "Gallery",
			thumbUrl    : "zigzag/10.png",
			tags        : ["Web", "Flash"],
			heightRatio	: true
		},
		{
			group		: "ZigZag",
			title       : "Tag cloud",
			thumbUrl    : "zigzag/11.png",
			tags        : ["Web", "Flash"],
			heightRatio	: true
		},
		{
			group		: "ZigZag",
			title       : "Home",
			thumbUrl    : "zigzag/thumb.png",
			tags        : ["Web", "Flash"],
			heightRatio	: true
		},





		{
			group		: "MAT Power",
			title       : "logo 1",
			thumbUrl    : "mat-power/1.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "MAT Power",
			title       : "logo 2",
			thumbUrl    : "mat-power/2.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "MAT Power",
			title       : "logo 3",
			thumbUrl    : "mat-power/3.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "MAT Power",
			title       : "logo 4",
			thumbUrl    : "mat-power/4.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "MAT Power",
			title       : "logo 5",
			thumbUrl    : "mat-power/5.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "MAT Power",
			title       : "logo 6",
			thumbUrl    : "mat-power/6.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "MAT Power",
			title       : "logo 7",
			thumbUrl    : "mat-power/7.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "MAT Power",
			title       : "Business Card",
			thumbUrl    : "mat-power/8.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "MAT Power",
			title       : "Business Card",
			thumbUrl    : "mat-power/thumb.png",
			tags        : ["Graphic", "Logo", "Business Card"],
			heightRatio	: true
		},





		{
			group		: "CSI Flash",
			title       : "Technologies",
			thumbUrl    : "novo/1.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "CSI Flash",
			title       : "Portfolio",
			thumbUrl    : "novo/2.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "CSI Flash",
			title       : "Solutions",
			thumbUrl    : "novo/3.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "CSI Flash",
			title       : "Entreprise",
			thumbUrl    : "novo/thumb.png",
			tags        : ["Flash"],
			heightRatio	: true
		},



		{
			group		: "Square",
			title       : "Splash",
			thumbUrl    : "square/1.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "Square",
			title       : "Home",
			thumbUrl    : "square/2.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "Square",
			title       : "Entreprise",
			thumbUrl    : "square/3.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "Square",
			title       : "Solutions",
			thumbUrl    : "square/4.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "Square",
			title       : "Technologies",
			thumbUrl    : "square/5.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "Square",
			title       : "Home",
			thumbUrl    : "square/thumb.png",
			tags        : ["Flash"],
			heightRatio	: true
		},



		{
			group		: "Nitro",
			title       : "Solutions",
			thumbUrl    : "nitro/1.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "Nitro",
			title       : "Technologies",
			thumbUrl    : "nitro/2.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "Nitro",
			title       : "Portfolio",
			thumbUrl    : "nitro/3.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "Nitro",
			title       : "Contact",
			thumbUrl    : "nitro/4.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "Nitro",
			title       : "Presentation",
			thumbUrl    : "nitro/thumb.png",
			tags        : ["Flash"],
			heightRatio	: true
		},



		{
			group		: "e-Design",
			title       : "Expanded",
			thumbUrl    : "tridesign/1.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "e-Design",
			title       : "Members",
			thumbUrl    : "tridesign/2.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "e-Design",
			title       : "Portfolio",
			thumbUrl    : "tridesign/3.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "e-Design",
			title       : "Presentation",
			thumbUrl    : "tridesign/4.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "e-Design",
			title       : "Home",
			thumbUrl    : "tridesign/thumb.png",
			tags        : ["Flash"],
			heightRatio	: true
		}

	];



var groups = {};//[];

var tagsMapping = [];

works.forEach(function (work, workIndex)
{
	if( work.hasOwnProperty("tags") )
	{
		work.tags.forEach(function (tag, tagIndex)
		{
			if( tagsMapping.indexOf(tag) < 0 )
			{
				tagsMapping.push(tag);
			}
		});
	}

	if( work.hasOwnProperty("group") )
	{
		if( groups.hasOwnProperty(work.group) )
		{
			groups[work.group].push(work);
		}
		else
		{
			groups[work.group] = [work];
		}
	}
});



//console.log(tagsMapping);

var margin = {top: 20, right: 20, bottom: 30, left: 40},
	width = 1000 - margin.left - margin.right,
	height = 700 - margin.top - margin.bottom;

var radius = 60;
var gap = 5;

var imageWidth = 150;
var imageHeight = 150;

var bodySelection = d3.select("body");

var workSVGSelection = bodySelection.select("#div-works-filters");

//var allTagsTag = d3.select("#div-works-filters")
//	.append("button")
//	.attr("id", "spanAllWorkTags")
//	.attr("class", "spanAllWorkTags tag active")
//	.text("All")
//	.on("click", function(d, i)
//	{
//		var realTags = $("button.workTag.active");
//
//		if( !$(this).hasClass("active") )
//		{
//			$(this).toggleClass("active");
//
//			//unselect the other tags.
//			$(".workTag").removeClass("active");
//		}
//		else if( $(this).hasClass("active") && realTags.length > 0 )
//		{
//			$(this).toggleClass("active");
//		}
//	});
//
//var workTags = d3.select("#div-works-filters")
//	.selectAll("button.workTag")
//    .data(tagsMapping)
//    .enter()
//    .append("button")
//	.attr("class", "workTag tag")
//    .text(function(d)
//    {
//        return d;
//    })
//	.on("click", function(d, i)
//	{
//		$(this).toggleClass("active");
//
//		var realTags = $("button.workTag.active");
//
//		if( realTags.length == 0 )
//		{
//			$("#spanAllWorkTags").addClass("active");
//		}
//		else
//		{
//			$("#spanAllWorkTags").removeClass("active");
//		}
//	});



var workElements = d3.select("#ul-works")
	.selectAll("li")
	.data(works)
	.enter()
	.append("li")
	.attr("class", "thumb")
	.attr("data-pile", function(d, i)
	{
		return d.group;
	});



//	.append("a")
//	.attr("href", "#");



var workElementsCaptions = workElements.append("span")
	.attr("class", "tp-info")
	.append("span")
	.text(function(d)
	{
		return d.title;
	});


var workElementsThumbs = workElements.append("img")
	.attr("width", function(d)
	{
		if( d.hasOwnProperty("widthRatio") )
		{
			if( d.widthRatio )
			{
				return 200;
			}
		}

		return null;
	})
	.attr("height", function(d)
	{
		if( d.hasOwnProperty("heightRatio") )
		{
			if( d.heightRatio )
			{
				return 150;
			}
		}

		return null;
	})
	.attr("src", function(d)
	{
		if( d.hasOwnProperty("thumbUrl") && d.thumbUrl != "" )
		{
			return "images/works/" + d.thumbUrl;
		}

		return "";
	});



var $grid = $('#ul-works'),
	$name = $('#span-work-category-name'),
	$close = $('#close'),
	$diapo = $('#buttonDiaporama'),
	$loader = $('<div class="loader"><i></i><i></i><i></i><span>Loading...</span></div>').insertBefore($grid),

	stapel = $grid.stapel(
	{
//		gutter: 20,
		onLoad : function()
		{
			$loader.remove();
		},
		onBeforeOpen : function( pileName )
		{
			$name.html( pileName );
		},
		onAfterOpen : function( pileName )
		{
			$close.show();
			$diapo.show();
		}
	} );

$close.on('click', function()
{
	$("#div-reveal-viewport").removeClass("open");

	$close.hide();
	$diapo.hide();
	$name.empty();
	stapel.closePile();
});

var clickedOnMenu = false;
var browserWidth = 0;
var browserHeight = 0;

function scrollOnClick()
{
	$("#nav-front-menu ul a, #span-contact a").click(function(e)
	{
		e.preventDefault();
		var t = $(this).attr("href").replace("/#", "");
		$.address.value(t);
		var n = $(this).attr("data-anchor"), r = $(n).attr("data-section-title");
		$.address.title(r);
		var i = $(n).offset().top, s = $("body").outerHeight();
		s - i < browserHeight && (i = s - browserHeight);
		clickedOnMenu = true;
		$("html:not(:animated),body:not(:animated)").animate({scrollTop: i}, 1500, "easeInOutQuint");
		return !1;
	});
}


function addressChange()
{
	$.address.change(function(e)
	{
		var t = e.path;

		$("#nav-front-menu a, #span-contact a").each(function()
		{
			var e = $(this).attr("href").replace("/#", "");

			if (e == t && !clickedOnMenu)
			{
				$(this).trigger("click", [!0]);
				clickedOnMenu = true;
			}
		});
	});
}


$(document).ready(function($)
{
	browserWidth = $(window).width();
    browserHeight = $(window).height();

	scrollOnClick();
	addressChange();


	$("#buttonCloseDiapo").click(function(event)
	{
		$("#div-reveal-viewport").removeClass("open");
		$("html:not(:animated),body:not(:animated)").animate(
			{
				scrollTop: $("#section-works").offset().top
			},
			1500,
			"easeInOutQuint"
		);
	});

	$("#buttonDiaporama").click(function(event)
	{
		var workCategoryName = $name.text();
		var galleryItems = [];

		if( groups.hasOwnProperty(workCategoryName) )
		{
			var rawItems = groups[workCategoryName];

			rawItems.forEach(function( item, index )
			{
				if( !item.hasOwnProperty("diaporama") || ( item.hasOwnProperty("diaporama") && item.diaporama == true ) )
				{
					galleryItems.push({ src: "images/works/" + item.thumbUrl });
				}
			});
		}

		$("#div-reveal-viewport").addClass("open");

		//remove current slides.
		$("#div-slides").html("");

		var slides = d3.select("#div-slides")
			.selectAll("section")
			.data(galleryItems)
			.enter()
			.append("section")
			.attr("class", "future");

		var images = slides.append("img")
			.attr('src', function(d)
			{
				return d.src;
			});

		$("#div-slides section:first-child").removeClass("future");
		$("#div-slides section:first-child").addClass("present");

		Reveal.slide(0);
		Reveal.sync();



		$("body").animate(
			{
				scrollTop: $("#div-reveal-viewport").offset().top
			},
			{
				duration: 1000,
				specialEasing:
				{
					scrollTop: 'easeInOutQuint'
				}
			}
		);
	});

});
