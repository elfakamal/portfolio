var works = [
		{
			group		: "Neiio Redesign",
			title       : "Slogans",
			thumbUrl    : "neiio-redesign/1.png",
			tags        : ["Web", "Graphic"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "Neiio Redesign",
			title       : "Neiio Connect",
			thumbUrl    : "neiio-redesign/2.png",
			tags        : ["Web", "Graphic"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "Neiio Redesign",
			title       : "Neiio Connect",
			thumbUrl    : "neiio-redesign/3.png",
			tags        : ["Web", "Graphic"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "Neiio Redesign",
			title       : "Groups",
			thumbUrl    : "neiio-redesign/4.png",
			tags        : ["Web", "Graphic"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "Neiio Redesign",
			title       : "Groups",
			thumbUrl    : "neiio-redesign/5.png",
			tags        : ["Web", "Graphic"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "Neiio Redesign",
			title       : "Neiio Organize",
			thumbUrl    : "neiio-redesign/6.png",
			tags        : ["Web", "Graphic"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "Neiio Redesign",
			title       : "Neiio Redesign",
			thumbUrl    : "neiio-redesign/thumb.png",
			tags        : ["Web", "Graphic", "Logo", "Business Card"],
			description	: "",
			heightRatio	: true
		},





		{
			group		: "CSI",
			title       : "Solutions",
			thumbUrl    : "csi/2.png",
			tags        : ["Web", "Logo"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "CSI",
			title       : "Home",
			thumbUrl    : "csi/1.png",
			tags        : ["Web", "Logo"],
			description	: "",
			heightRatio	: true
		},
		{
			group		: "CSI",
			title       : "CSI",
			thumbUrl    : "csi/thumb.png",
			imageUrl	: "csi/3.png",
			tags        : ["Web", "Logo"],
			description	: "",
			heightRatio	: true
		},





		{
			group       : "HTag",
			title       : "HTag",
			thumbUrl    : "htag/1.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group       : "HTag",
			title       : "HTag",
			thumbUrl    : "htag/2.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group       : "HTag",
			title       : "HTag",
			thumbUrl    : "htag/5.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group       : "HTag",
			title       : "HTag",
			thumbUrl    : "htag/thumb.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},





		{
			group		: "Personal",
			title       : "Personal",
			thumbUrl    : "personal/1.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "Personal",
			title       : "Personal",
			thumbUrl    : "personal/2.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "Personal",
			title       : "Personal",
			thumbUrl    : "personal/3.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "Personal",
			title       : "Personal",
			thumbUrl    : "personal/thumb.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},





		{
			group		: "ZigZag",
			title       : "Wireframing",
			thumbUrl    : "zigzag/1.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "ZigZag",
			title       : "Vertical ZigZag",
			thumbUrl    : "zigzag/2.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "ZigZag",
			title       : "ZigZag logo",
			thumbUrl    : "zigzag/3.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "ZigZag",
			title       : "ZigZag logo",
			thumbUrl    : "zigzag/4.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "ZigZag",
			title       : "ZigZag logo",
			thumbUrl    : "zigzag/5.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "ZigZag",
			title       : "ZigZag logo",
			thumbUrl    : "zigzag/6.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "ZigZag",
			title       : "ZigZag logo",
			thumbUrl    : "zigzag/7.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "ZigZag",
			title       : "Business Card",
			thumbUrl    : "zigzag/8.png",
			tags        : ["Business Card"],
			heightRatio	: true
		},
		{
			group		: "ZigZag",
			title       : "Business Card",
			thumbUrl    : "zigzag/9.png",
			tags        : ["Business Card"],
			heightRatio	: true
		},
		{
			group		: "ZigZag",
			title       : "Gallery",
			thumbUrl    : "zigzag/10.png",
			tags        : ["Web", "Flash"],
			heightRatio	: true
		},
		{
			group		: "ZigZag",
			title       : "Tag cloud",
			thumbUrl    : "zigzag/11.png",
			tags        : ["Web", "Flash"],
			heightRatio	: true
		},
		{
			group		: "ZigZag",
			title       : "Home",
			thumbUrl    : "zigzag/thumb.png",
			tags        : ["Web", "Flash"],
			heightRatio	: true
		},





		{
			group		: "MAT Power",
			title       : "logo 1",
			thumbUrl    : "mat-power/1.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "MAT Power",
			title       : "logo 2",
			thumbUrl    : "mat-power/2.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "MAT Power",
			title       : "logo 3",
			thumbUrl    : "mat-power/3.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "MAT Power",
			title       : "logo 4",
			thumbUrl    : "mat-power/4.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "MAT Power",
			title       : "logo 5",
			thumbUrl    : "mat-power/5.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "MAT Power",
			title       : "logo 6",
			thumbUrl    : "mat-power/6.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "MAT Power",
			title       : "logo 7",
			thumbUrl    : "mat-power/7.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "MAT Power",
			title       : "Business Card",
			thumbUrl    : "mat-power/8.png",
			tags        : ["Graphic", "Logo"],
			heightRatio	: true
		},
		{
			group		: "MAT Power",
			title       : "Business Card",
			thumbUrl    : "mat-power/thumb.png",
			tags        : ["Graphic", "Logo", "Business Card"],
			heightRatio	: true
		},





		{
			group		: "CSI Flash",
			title       : "Technologies",
			thumbUrl    : "novo/1.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "CSI Flash",
			title       : "Portfolio",
			thumbUrl    : "novo/2.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "CSI Flash",
			title       : "Solutions",
			thumbUrl    : "novo/3.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "CSI Flash",
			title       : "Entreprise",
			thumbUrl    : "novo/thumb.png",
			tags        : ["Flash"],
			heightRatio	: true
		},



		{
			group		: "Square",
			title       : "Splash",
			thumbUrl    : "square/1.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "Square",
			title       : "Home",
			thumbUrl    : "square/2.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "Square",
			title       : "Entreprise",
			thumbUrl    : "square/3.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "Square",
			title       : "Solutions",
			thumbUrl    : "square/4.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "Square",
			title       : "Technologies",
			thumbUrl    : "square/5.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "Square",
			title       : "Home",
			thumbUrl    : "square/thumb.png",
			tags        : ["Flash"],
			heightRatio	: true
		},



		{
			group		: "Nitro",
			title       : "Solutions",
			thumbUrl    : "nitro/1.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "Nitro",
			title       : "Technologies",
			thumbUrl    : "nitro/2.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "Nitro",
			title       : "Portfolio",
			thumbUrl    : "nitro/3.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "Nitro",
			title       : "Contact",
			thumbUrl    : "nitro/4.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "Nitro",
			title       : "Presentation",
			thumbUrl    : "nitro/thumb.png",
			tags        : ["Flash"],
			heightRatio	: true
		},



		{
			group		: "e-Design",
			title       : "Expanded",
			thumbUrl    : "tridesign/1.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "e-Design",
			title       : "Members",
			thumbUrl    : "tridesign/2.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "e-Design",
			title       : "Portfolio",
			thumbUrl    : "tridesign/3.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "e-Design",
			title       : "Presentation",
			thumbUrl    : "tridesign/4.png",
			tags        : ["Flash"],
			heightRatio	: true
		},
		{
			group		: "e-Design",
			title       : "Home",
			thumbUrl    : "tridesign/thumb.png",
			tags        : ["Flash"],
			heightRatio	: true
		}

	];



var tagsMapping = [];

works.forEach(function (work, workIndex)
{
	if( work.hasOwnProperty("tags") )
	{
		work.tags.forEach(function (tag, tagIndex)
		{
			if( tagsMapping.indexOf(tag) < 0 )
			{
				tagsMapping.push(tag);
			}
		});
	}
});

//console.log(tagsMapping);

var margin = {top: 20, right: 20, bottom: 30, left: 40},
	width = 1000 - margin.left - margin.right,
	height = 700 - margin.top - margin.bottom;

var radius = 60;
var gap = 5;

var imageWidth = 150;
var imageHeight = 150;

var bodySelection = d3.select("body");

var workSVGSelection = bodySelection.select("#div-works-filters");

//var filtersTitle = workSVGSelection.append("div")
//    .attr("id", "div-works-filters-title")
//    .text("Filters");

//var filterItems = workSVGSelection.append("div")
//    .attr("id", "div-works-filters-items");

var allTagsTag = d3.select("#div-works-filters")
	.append("button")
	.attr("id", "spanAllWorkTags")
	.attr("class", "spanAllWorkTags tag active")
	.text("All")
	.on("click", function(d, i)
	{
		var realTags = $("button.workTag.active");

		if( !$(this).hasClass("active") )
		{
			$(this).toggleClass("active");

			//unselect the other tags.
			$(".workTag").removeClass("active");
		}
		else if( $(this).hasClass("active") && realTags.length > 0 )
		{
			$(this).toggleClass("active");
		}
	});

var workTags = d3.select("#div-works-filters")
	.selectAll("button.workTag")
    .data(tagsMapping)
    .enter()
    .append("button")
	.attr("class", "workTag tag")
    .text(function(d)
    {
        return d;
    })
	.on("click", function(d, i)
	{
		$(this).toggleClass("active");

		var realTags = $("button.workTag.active");

		if( realTags.length == 0 )
		{
			$("#spanAllWorkTags").addClass("active");
		}
		else
		{
			$("#spanAllWorkTags").removeClass("active");
		}
	});



var workElements = d3.select("#ul-works")
	.selectAll("li")
	.data(works)
	.enter()
	.append("li")
	.attr("data-pile", function(d, i)
	{
		return d.group;
	})
	.append("a")
	.attr("href", "#");



var workElementsCaptions = workElements.append("span")
	.attr("class", "tp-info")
	.append("span")
	.text(function(d)
	{
		return d.title;
	});


var workElementsThumbs = workElements.append("img")
	.attr("width", function(d)
	{
		if( d.hasOwnProperty("widthRatio") )
		{
			if( d.widthRatio )
			{
				return 200;
			}
		}

		return null;
	})
	.attr("height", function(d)
	{
		if( d.hasOwnProperty("heightRatio") )
		{
			if( d.heightRatio )
			{
				return 150;
			}
		}

		return null;
	})
	.attr("src", function(d)
	{
		if( d.hasOwnProperty("thumbUrl") && d.thumbUrl != "" )
		{
			return "images/works/" + d.thumbUrl;
		}

		return "";
	});



var $grid = $('#ul-works'),
	$name = $('#span-work-category-name'),
	$close = $('#close'),
	$loader = $('<div class="loader"><i></i><i></i><i></i><span>Loading...</span></div>').insertBefore($grid),

	stapel = $grid.stapel(
	{
//		gutter: 20,
		onLoad : function()
		{
			$loader.remove();
		},
		onBeforeOpen : function( pileName )
		{
			$name.html( pileName );
		},
		onAfterOpen : function( pileName )
		{
			$close.show();
		}
	} );

$close.on('click', function()
{
	$close.hide();
	$name.empty();
	stapel.closePile();
});



